# Stone Wall Blueprint
# A defensive fortification wall made of stone blocks

[meta]
id = "stone_wall"
name = "Stone Wall"
category = "wall"
origin = "constructed"
description = "A defensive stone wall providing cover and blocking movement"

[parameters]
length = { type = "float", min = 2.0, max = 20.0, default = 5.0 }
height = { type = "float", min = 1.0, max = 5.0, default = 2.5 }
thickness = { type = "float", min = 0.4, max = 1.5, default = 0.6 }

[geometry]
width = "length"
depth = "thickness"
height = "height"
shape = "rectangle"

[stats.military]
max_hp = "length * height * 80"
hardness = "5"
cover_value = "height >= 1.5 ? 1.0 : 0.5"
blocks_movement = "1"
blocks_los = "1"
movement_cost = "999"
flammable = "0"
elevation = "0"

[stats.civilian]
pedestrian_capacity = "0"
cart_accessible = "0"
worker_capacity = "0"
storage_capacity = "0"
prestige_modifier = "0"

[construction]
base_time = "length * height * 20"
labor_cap = "ceil(length / 2)"

[construction.cost]
stone = "length * height * 10"
mortar = "length * height * 2"

[[construction.stages]]
id = "foundation"
progress_threshold = 0.0
height_multiplier = 0.3
visual_state = "foundation"
[construction.stages.overrides]
cover_value = 0.2
blocks_movement = false
blocks_los = false

[[construction.stages]]
id = "half_height"
progress_threshold = 0.25
height_multiplier = 0.5
visual_state = "half_built"
[construction.stages.overrides]
cover_value = 0.5
blocks_movement = true
blocks_los = false

[[construction.stages]]
id = "near_complete"
progress_threshold = 0.75
height_multiplier = 0.9
visual_state = "nearly_complete"
[construction.stages.overrides]
cover_value = 0.8
blocks_movement = true
blocks_los = true

[[construction.stages]]
id = "complete"
progress_threshold = 1.0
height_multiplier = 1.0
visual_state = "complete"

[[anchors]]
name = "west"
position = ["-length / 2", "0", "0"]
direction = "west"
tags = ["wall_connect", "extension"]

[[anchors]]
name = "east"
position = ["length / 2", "0", "0"]
direction = "east"
tags = ["wall_connect", "extension"]

[[anchors]]
name = "top"
position = ["0", "0", "height"]
direction = "up"
tags = ["battlement", "tower_mount"]

[[damage_states]]
name = "intact"
threshold = 0.75
visual_overlay = ""
tags = []
creates_breach = false
produces_rubble = false

[[damage_states]]
name = "damaged"
threshold = 0.5
visual_overlay = "cracks"
tags = ["damaged"]
creates_breach = false
produces_rubble = false
[damage_states.overrides]
cover_value = 0.8
hardness = 4.0

[[damage_states]]
name = "breached"
threshold = 0.25
visual_overlay = "breach"
tags = ["breached", "damaged"]
creates_breach = true
produces_rubble = true
[damage_states.overrides]
cover_value = 0.5
blocks_movement = false
blocks_los = false

[[damage_states]]
name = "collapsed"
threshold = 0.0
visual_overlay = "rubble"
tags = ["destroyed", "rubble"]
creates_breach = true
produces_rubble = true
[damage_states.overrides]
cover_value = 0.3
blocks_movement = false
blocks_los = false
hardness = 0.0

[[constraints]]
description = "Minimum length requirement"
expression = "length >= 2"
error_message = "Wall must be at least 2 meters long"

[[constraints]]
description = "Height to length stability ratio"
expression = "height <= length * 0.8"
error_message = "Wall is too tall for its length - risk of toppling"

[[constraints]]
description = "Thickness to height structural requirement"
expression = "thickness >= height * 0.15"
error_message = "Wall thickness is insufficient for the height"
